## 概要说明

在一个项目的开发和测试过程中，有套快速有效的基础数据和开发测试数据重建生成机制非常有必要。一般传统的做法是额外维护一套数据SQL脚本，但是这个做法有个比较大的问题就在于，程序代码不断迭代更新数据库结构随时变更，需要同步管理维护SQL脚本的结构定义和数据变更工作非常繁琐。

既然框架选择了Hibernate作为ORM处理，并且提倡以Code First风格直接定义Entity对象直接以hbm2ddl生成数据库结构，索性再进一步把基础数据和开发测试数据的维护也以Java代码的方式来实现。这样的方式对于开发人员来说也更容易上手，一边开发一边维护数据，随时保持代码和数据的同步一致性。

### 数据重建功能的目标

对于数据的处理，我们希望能达到如下目标：

* 只要有个可用数据库，能随时随地自动完成重建开发或测试环境需要的数据
* 应用反复更新部署，既能自动追加新的数据，又尽量不影响已有的数据，避免影响开发或测试的连续性

### 数据初始化设计



### 权限基础数据处理

对于Web应用最典型的权限控制粒度就是在Web Action或Controller层方法的访问控制，基于框架集成的Apache Shiro，相比Spring Security权限组件，Shiro一个比较实用的特性就是其控制粒度比角色Role还细一层可以基于权限Permission进行控制。为了实现细粒度的权限控制，因此采用实用Shiro的@RequiresPermissions注解在Controller方法上，例如：

~~~
    @MenuData("配置管理:权限管理:用户账号")
    @RequiresPermissions("配置管理:权限管理:用户账号")
    @RequestMapping(value = "", method = RequestMethod.GET)
    public String index(Model model) {
        model.addAttribute("authTypeMap", EnumUtils.getEnumDataMap(AuthTypeEnum.class));
        return "admin/auth/user-index";
    }
~~~

其中，为了便于直观生成权限配置数据，就不再额外定义权限代码，而是直接在@RequiresPermissions注解中实用中文字符，并且以冒号作为层次划分标识。