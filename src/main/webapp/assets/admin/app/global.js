var Global=function(){var a;return{init:function(){if(bootbox){bootbox.setDefaults({locale:"zh_CN"})}if($.fn.daterangepicker){$.fn.daterangepicker.defaults={opens:(App.isRTL()?"left":"right"),startDate:moment().subtract("days",29),endDate:moment(),dateLimit:{days:365},showDropdowns:true,showWeekNumbers:true,timePicker:false,timePickerIncrement:1,timePicker12Hour:true,ranges:{"今天":[moment(),moment()],"昨天":[moment().subtract("days",1),moment().subtract("days",1)],"最近一周":[moment().subtract("days",6),moment()],"未来一周":[moment(),moment().add("days",6)],"最近一月":[moment().subtract("days",29),moment()],"未来一月":[moment(),moment().add("days",29)],"最近一季度":[moment().subtract("days",89),moment()],"本月":[moment().startOf("month"),moment().endOf("month")],"上月":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},buttonClasses:["btn"],applyClass:"green",cancelClass:"default",format:"YYYY-MM-DD",separator:" ～ ",locale:{applyLabel:"确定",fromLabel:"从",toLabel:"到",customRangeLabel:"自由选取",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],firstDay:1}}}(function(j){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(j)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(j.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);if($.fn.editable){$.fn.editable.defaults.inputclass="form-control"}var c=$(window).height()-$("body > .header").height()-$("body > .footer").height()-15;$(".page-container > .page-content").css({"min-height":c+"px"});$(window).resize(function(){if($.fn.jqGrid){Grid.refreshWidth()}});var e=false;var g=function(){if(e==true){return}e=true;if($(this).scrollTop()+$(window).height()+20>=$(document).height()){$(".table-infinite-scroll").trigger("infinite-scroll")}else{e=false}};$(window).on("infinite-scroll-done",function(j){e=false});$(window).on("mousewheel",function(j){g.call(this)});$(window).on("scroll",function(j){g.call(this)});toastr.options={tapToDismiss:false,closeButton:true,positionClass:"toast-bottom-right",extendedTimeOut:600000};$("#form-unlock").submit(function(j){j.preventDefault();$(this).ajaxPostForm({success:function(){$("body").data("backstretch").destroy();$("#page-lock").hide();$(".page-container,.header,.footer").fadeIn(2000);$(this).find("input[name='password']").val("");$("#btn-dashboard").click()},confirmMsg:false});return false});$("#a-logout").click(function(){bootbox.confirm("确认注销登录吗？",function(j){if(j){window.location.href=WEB_ROOT+"/admin/logout"}})});$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(n){Util.debug(n.target+":"+n.type);var j=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var m=j.find("> .nav > li.active > a");var l=j.find(m.attr("href"));var k=m.attr("data-url");l.ajaxGetUrl(k)});var b=$(".page-sidebar-menu");if(b.size()>0){var i=function(n,p){var m=n.initOpen?"open":"";var o=n.active?"active":"";var k=n.url?WEB_ROOT+"/admin":"javascript:;";var q=p[p.length-1];var l=false;if(n.url){l=(Pinyin.getCamelChars(q)+"").toLowerCase()}var j='<li class="menu '+o+" "+m+'" data-path="'+n.path+'">';j+='<a href="javascript:;" '+(l?' data-py="'+l+'"':"")+(n.url?' rel="address:'+n.url+"|"+n.path+'"':"")+">";if(n.style){j+='<i class="fa '+n.style+'"></i>'}else{if(p.length==1){j+='<i class="fa fa-cogs"></i>'}else{if(n.url){j+='<i class="fa fa-dot-circle-o"></i>'}else{j+='<i class="fa fa-ellipsis-vertical"></i>'}}}if(p.length==1){j+='<span class="title">'+q+"</span>";j+='<span class="selected"></span>'}else{j+=q}if(!n.url){j+='<span class="arrow  '+m+'"></span></a></li>'}j+="</a></li>";return j};b.ajaxJsonUrl(WEB_ROOT+"/admin/menus",function(l){var j=undefined;var k=window.location.hash;if(k&&k!=""){k=k.replace("#","").split("|")[0];$.each(l,function(m,n){if(k==n.url){j=n.path;return false}})}$.each(l,function(p,q){if(Util.startWith(j,q.path)){q.initOpen=true;q.active=true}var r=q.path.split(":");if(r.length==1){b.append(i(q,r))}else{var o=[];$.each(r,function(u,t){if(u<r.length-1){o.push(t)}});var n=o.join(":");var s=b.find("li[data-path='"+n+"']");var m=s.find("> ul.sub-menu");if(m.size()==0){m=$('<ul class="sub-menu" style="display: '+(s.is(".open")?"block":"none")+';">').appendTo(s)}m.append(i(q,r))}})});$.address.change(function(l){App.scrollTop();if(l.value=="/"||l.value=="/dashboard"){Global.addOrActivePanel("/admin/dashboard|Dashboard")}else{if(l.value=="/lock"){$.backstretch(["assets/img/bg/1.jpg","assets/img/bg/2.jpg","assets/img/bg/3.jpg","assets/img/bg/4.jpg"],{fade:1000,duration:8000});$(".page-container,.header,.footer").hide();$("#form-unlock").find(":text").focus().val("");$("#page-lock").show();$("#form-unlock").find("input").first().focus();$("body").ajaxPostURL({url:WEB_ROOT+"/layout!lock",confirmMsg:false})}else{var m=$('.page-sidebar li.menu > a[rel^="address:'+l.value+'"]');if(m.size()>0){Global.addOrActivePanel(m.attr("rel").replace("address:",""));var o=$(".page-sidebar-menu").find("li");o.removeClass("active").removeClass("open");var n=m.parent("li");n.addClass("active");var j=n.closest("ul.sub-menu");while(j.size()>0){j.show();var k=j.parent("li");k.addClass("open");k.find(" > a > span.arrow").addClass("open");j=k.closest("ul.sub-menu")}}else{Global.addOrActivePanel(l.value)}}}});$('.sidebar-search input[name="search"]').autocomplete({autoFocus:true,source:function(l,j){var k=b.find("a[data-py]");return j(k.map(function(){var p=l.term.toLowerCase();var m=$(this);var o=m.text();var n=m.attr("data-py");if(n.indexOf(p)>-1||o.indexOf(p)>-1){return{label:$.trim(o),link:m,href:m.attr("href")}}}))},minLength:1,select:function(k,l){var j=l.item;$(this).parent().find(".submit").data("link",j.link);j.link.click();return true}}).focus(function(){$(this).select()}).val("").focus();$('.sidebar-search input[name="search"]').parent().find(".submit").click(function(){var j=$(this).data("link");if(j){j.click()}return false})}var h=$("#header_notification_bar .badge");if(h.size()>0){$.ajax({dataType:"json",method:"get",url:WEB_ROOT+"/admin/profile/notify-message-count",success:function(j){var k=j.userdata;if(k>0){$("#messageInfo").html("<a href='javascripts:;' rel='address:/admin/profile/notify-message?toRead=1|未读消息列表'>您有 "+k+" 条未读消息</a>");h.html(k).show()}else{$("#messageInfo").html("<a href='javascripts:;' rel='address:/admin/profile/notify-message|消息列表'>暂无未读消息，点击查看消息列表</a>");h.html(0).hide()}}})}$("body").on("click",".paging_bootstrap a",function(){var m=$(this);var o=m.closest(".paging_bootstrap");if(o.attr("target")==undefined||o.attr("target")=="ajax-get-container"){var n=m.closest(".ajax-get-container");var k=n.attr("data-url");n.ajaxGetUrl(Util.AddOrReplaceUrlParameter(k,"page",m.attr("page")))}else{var j=$(o.attr("target"));if(j.is("form")){var l=j.find("input[name='page']");if(l.size()==0){l=$("<input type='hidden' name='page'/>").appendTo(j)}l.val(m.attr("page"));j.submit();return false}}});$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(n){Util.debug(n.target+":"+n.type);var j=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var m=j.find("> .nav > li.active > a");var l=j.find(m.attr("href"));var k=m.attr("data-url");l.ajaxGetUrl(k)});jQuery("body").on("click",".captcha-img",function(k){$(".captcha-img").each(function(){$(this).attr("src",WEB_ROOT+"/assets/img/captcha_placeholder.jpg")});$(this).attr("src",WEB_ROOT+"/pub/jcaptcha.servlet?_="+new Date().getTime());var j=$(this).closest(".form-group").find(".captcha-text");j.focus();j.select();return false});jQuery("body").on("focus",".captcha-text",function(k){var j=$(this).closest(".form-group").find(".captcha-img");if(j.attr("src")==WEB_ROOT+"/assets/img/captcha_placeholder.jpg"){j.click()}});jQuery("body").on("dblclick",".portlet-title",function(j){$(this).find(".tools .collapse,.tools .expand").click()});jQuery("body").on("click","#layout-nav >  li > .btn-close-active",function(m){var l=$("#layout-nav");var k=l.next(".tab-content").find(".panel-content:visible").attr("data-url");var j=l.find(" > .btn-group > ul.dropdown-menu");j.find("a[href='"+k+"']").find(".badge").click()});jQuery("body").on("click","ul.nav > li.tools > .reload",function(n){Util.debug(n.target+":"+n.type);n.preventDefault();var j=$(this).closest(".nav");var m=j.find("li.active > a");var l=j.closest(".tabbable").find(m.attr("href"));if(m.attr("data-url")){var k=m.attr("data-url");l.ajaxGetUrl(k,function(){l.find(".tabbable:first > .nav > li.active > a").click()})}else{if(jQuery().jqGrid){l.find("table.ui-jqgrid-btable").each(function(){var o=$(this);o.trigger("clearToolbar");var p=o.attr("data-url");o.jqGrid("setGridParam",{datatype:"json",url:p}).trigger("reloadGrid")})}}});jQuery("body").on("click",'[data-toggle="buttons"] > label.btn',function(k){var j=$(this);if(j.is(".clear")){$(this).parent().find("> label.btn:not(.clear)").removeClass("active");$(this).parent().find("> label.btn:not(.clear) > input[type='checkbox']").attr("checked",false)}else{$(this).parent().find("> label.btn.clear").removeClass("active")}});jQuery("body").on("click",'[data-toggle="buttons"] > label.btn',function(j){$(this).parent().find("> label.clear").removeClass("active")});jQuery("body").on("click",".portlet-title > .tools > .reload",function(l){Util.debug(l.target+":"+l.type);l.preventDefault();var k=$(this).closest(".ajaxify");if(k.attr("data-url")){var j=k.attr("data-url");k.ajaxGetUrl(j)}});$(document).off("click.tab.data-api");$(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(n){Util.debug(n.target+":"+n.type);var m=$(this);var o=m.attr("data-ajax");if(o=="false"){return}if(m.hasClass("disabled")||m.attr("data-tab-disabled")=="true"){return false}var l=m.attr("data-url")?m.attr("data-url"):m.attr("href");l=$.trim(l);if(!Util.startWith(l,"#")){m.attr("data-url",l);var j="tab_content_"+Util.hashCode(l);m.attr("href","#"+j);var s=m.closest("ul.nav").parent();var r=s.find(" > div.tab-content");if(r.length==0){r=$('<div class="tab-content">').appendTo(s)}var k=r.find("div#"+j);if(k.length==0){k=$('<div id="'+j+'" class="tab-pane active">').appendTo(r)}if(k.is(":empty")){k.ajaxGetUrl(l,function(){k.append('<div style="clear:both"></div>');k.find(".nav > li.active > a").click()})}}$(this).tab("show");var q=$(this).closest(".nav-tabs");var p=q.find("li:not(.tools)").index($(this).parent("li"));q.attr("data-active",p);if($.jgrid){Grid.refreshWidth()}n.preventDefault()});$(".page-sidebar, .header").on("click",".sidebar-toggler",function(j){Grid.refreshWidth()});jQuery("body").on("click",'a[data-toggle="modal-ajaxify"],a[target="modal-ajaxify"]',function(j){Util.debug(j.target+":"+j.type);j.preventDefault();$(this).popupDialog()});if($.fn.fileupload){$("#fileupload").fileupload({autoUpload:false,dataType:"json",url:WEB_ROOT+"/sys/attachment-file!uploadMulti"});var f=$("#fileupload");var d=null;jQuery("body").on("click","a.btn-fileinput-trigger",function(k){d=$(this);var j=d.attr("data-category");if(j){f.find("input[name='attachmentName']").val("_attachment_"+j)}f.find("tbody.files").empty()});jQuery("#fileupload-dialog").on("click",".modal-footer .btn-add",function(l){var k=d.parent().find("table.table-filelist");if(k.size()==0){k=$('<table role="presentation" class="table table-striped table-filelist clearfix"><tbody class="files"></tbody></table>').insertAfter(d)}var j=k.find("tbody.files");$("#fileupload").find("tbody.files tr.template-download").each(function(){j.append($(this).clone(true))});$("#fileupload-dialog").find('.modal-footer [data-dismiss="modal"]').click()})}jQuery("body").on("click",'a[data-toggle="panel"],button[data-toggle="panel"]',function(k){Util.debug(k.target+":"+k.type);k.preventDefault();var j=$(this);Global.addOrActivePanel(j)});jQuery("body").on("click",".btn-post-url",function(l){Util.debug(l.target+":"+l.type);l.preventDefault();var k=$(this);var j=null;if(k.is("button")){j=k.attr("data-url")}else{if(k.is("a")){j=k.attr("href")}}var m=k.data("success");if(m==undefined){m=function(n){var p=k.attr("data-ajaxify-reload");if(p!="false"){$(p).each(function(){$(this).ajaxGetUrl($(this).attr("data-url"))})}var o=k.attr("data-reload");if(o){if(o=="page"){window.location.reload()}}}}k.ajaxPostURL({url:j,success:m,confirmMsg:k.attr("data-confirm")})});jQuery("body").on("click","tbody.select-table-checkbox",function(k){var j=$(this).find(".table-checkbox :checkbox");if(!(j.is(k.target)||j.find(k.target).length)){j.attr("checked",!j.is(":checked"))}})},findUserProfileParams:function(b){if(a==undefined||a==null){a=$("body").cacheData(WEB_ROOT+"/profile/simple-param-val!params.json")}return a[b]},setUserProfileParams:function(b,c){if(a==undefined||a==null){a=$("body").cacheData(WEB_ROOT+"/profile/simple-param-val!params.json")}a[b]=c},notify:function(b,c,d){if(b=="error"||b=="failure"){b="error";toastr.options.timeOut=10000;toastr.options.positionClass="toast-bottom-center"}else{toastr.options.timeOut=2000;toastr.options.positionClass="toast-bottom-right"}if(d==undefined){d=""}if(c==null||c==undefined||c==""){c="操作已处理完成"}toastr[b](c,d)},addOrActivePanel:function(l,m){l=decodeURI(l);var b=l;var j=l.split("|");if(j.length>1){b=j[0];if(m==undefined){m=j[1]}}b=WEB_ROOT+b;var h=m.split(":");var d=h[h.length-1];var m='<li><a href="#dashboard" class="btn-dashboard"><i class="fa fa-home"></i> 首页 </a></li> ';var f=$("#layout-nav");f.find("> li:not(.btn-group)").remove();$.each(h,function(o,n){n=n;if(o<h.length-1){m+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> '+n+" </li>"}else{m+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> <a class="reload" href="javascript:;">'+n+"</a> </li>"}});f.append(m);var e=f.next(".tab-content");var k=e.find("> div[data-url='"+b+"']");if(k.length==0){k=$('<div data-url="'+b+'" class="panel-content"></div>').appendTo(e);k.ajaxGetUrl(b)}else{k.show()}e.find("> div").not(k).hide();var c=f.find(" > .btn-group > ul.dropdown-menu");var g=c.find("> li > a[rel='address:"+l+"']");if(g.length==0){g=$('<a href="javascripts:;" rel="address:'+l+'">'+d+'<span class="badge badge-default">X</span></a>').appendTo(c).wrap("<li/>");g.find(".badge").click(function(p){p.preventDefault();p.stopPropagation();var o=false;k.find("form[method='post']:not(.form-track-disabled)[form-data-modified='true']").each(function(){var r=$(this);if(!confirm("当前表单有修改数据未保存，确认离开当前表单吗？")){o=true;return false}});if(!o){g.parent("li").remove();k.remove();var n=1;c.find("> li").not(g).each(function(){var r=$(this).attr("count");if(r){if(Number(r)>n){n=Number(r)}}});var q=c.find("> li[count='"+n+"'] > a");if(q.length>0){q.click()}else{$("#layout-nav >  li > .btn-dashboard").click()}}})}var i=1;c.find("> li").each(function(){$(this).removeClass("active");var n=$(this).attr("count");if(n){if(Number(n)>i){i=Number(n)}}});g.parent("li").addClass("active");g.parent("li").attr("count",i+1);f.find("> li:not(.btn-group) > a.reload").click(function(n){n.preventDefault();k.ajaxGetUrl(b)})}}}();