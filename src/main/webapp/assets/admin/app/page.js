var AdminPage=function(){return{initDataProfileParam:function(a){$("#btn-profile-param").hide();$("input[data-profile-param],radio[data-profile-param],select[data-profile-param]",a).each(function(){var d=$(this);if(d.attr("data-profile-param-done")){return this}d.attr("data-profile-param-done",true);var f=d.attr("data-profile-param");var b=d.closest(".controls");var i="data-profile-param-done"+f;if(b.attr(i)){return}b.attr(i,true);var h=d.closest("form").find("input[name='id']").val();var g=d.val();if(h.length==0&&(g==undefined||g=="")){var c=AdminGlobal.findUserProfileParams(f);if(c){if(d.is('[type="radio"]')){b.find('[type="radio"][value="'+c+'"]').attr("checked",true)}else{d.val(c);if(d.is("select")){d.select2()}}}}var e=$("#btn-profile-param");b.add(d).mouseenter(function(){e.toggle();e.position({my:"right center",at:"left center",of:b});e.off();e.click(function(){var k=[];var j={};b.find("[data-profile-param]").each(function(){var n;var m=$(this);if(m.is('[type="radio"]')){n=b.find(":checked").val()}else{n=m.val()}var l=m.attr("data-profile-param");k.push(l);j[l]=n});j.codes=k.join(",");e.ajaxPostURL({url:WEB_ROOT+"/admin/sys/user-profile-data/edit",success:function(){$.each(k,function(l,m){Global.setUserProfileParams(m,j[m])});e.hide()},confirmMsg:false,data:j})})})})},initTreeSelect:function(a){$('input[data-toggle="tree-select"]',a).each(function(){var b=$(this);b.treeSelect()})},initUploadBigFile:function(a){$('input[data-upload="single-big-file"]',a).each(function(){var b=$(this);if(b.attr("data-upload-done")){return this}b.attr("data-upload-done",true);var f="__single-big-file_id_"+new Date().getTime();b.attr("id",f);var e=f+"_file";var d=$("<a href=''>"+b.val()+"</a>").insertAfter(b);var c=$('<input type="file" id="'+e+'"/>').insertAfter(b);$("#"+e).uploadify({fileObjName:"fileUpload",buttonText:"选择文件上传",multi:false,swf:WEB_ROOT+"/assets/plugins/uploadify/uploadify.swf",uploader:WEB_ROOT+"/w/file/upload/single.json",onUploadSuccess:function(h,i,g){alert(g)},onUploadError:function(g,j,i,h){alert("The file "+g.name+" could not be uploaded: "+h)}})})},initUploadSingleImage:function(a){$('input[data-upload="single-image"]',a).each(function(){var k=$(this);if(k.attr("data-upload-done")){return this}k.attr("data-upload-done",true);if(k.attr("id")==undefined){k.attr("id","single_image_id_"+new Date().getTime())}var l={width:"150px",height:"150px"};if(k.attr("data-image-width")){l.width=k.attr("data-image-width");if(!Util.endWith(l.width,"px")){l.width=l.width+"px"}}if(k.attr("data-image-height")){l.height=k.attr("data-image-height");if(!Util.endWith(l.height,"px")){l.height=l.height+"px"}}var h=k.parent("td");if(h.size()==0){h=k.closest("div.form-group").children("div")}var b=$('<div class="thumbnail" style=" width: '+l.width+'"/>').appendTo(h);var c=$('<div class="div-add-img" style="line-height: '+l.height+'; background-color: #EEEEEE; text-align: center;"/>');c.append('<p><button class="btn btn-large" type="button"><i class="fa fa-arrow-circle-o-up"></i></button></p>');var j=$('<div class="caption" style="height: 15px;padding-top:0px">');var d=$('<a class="btn-add pull-right" style="cursor: pointer;" title="点击上传图片"><i class="fa fa-plus"></i></a>');var i=$('<a class="btn-view" style="cursor: pointer;"  title="查看原始图片"><i class="fa fa-picture-o"></i></a>');var e=$('<a class="btn-remove pull-right"  style="cursor: pointer;" title="点击移除图片"><i class="fa fa-minus"></i></a>');var f=k.val();if(f==undefined||f==""){c.appendTo(b);j.appendTo(b);j.append(d)}else{if(READ_FILE_URL_PREFIX){b.append('<img src="'+READ_FILE_URL_PREFIX+f+'" style="cursor: pointer; width: '+l.width+"; height: "+l.height+';" />')}else{b.append('<img src="'+f+'" style="cursor: pointer; width: '+l.width+"; height: "+l.height+';" />')}j.appendTo(b);j.append(i);j.append(e)}var g=KindEditor.editor({allowFileManager:false});b.delegate("div.div-add-img, a.btn-add , img","click",function(){g.loadPlugin("image",function(){g.plugin.imageDialog({showRemote:false,clickFn:function(o,r,p,m,n,s){var q=o;if(Util.startWith(o,"http")){q=o.split(READ_FILE_URL_PREFIX)[1]}else{q=o;o=READ_FILE_URL_PREFIX+q}k.val(q);if(b.find("img").length==0){c.hide();b.prepend('<img src="'+o+'" style="cursor: pointer; width: '+l.width+"; height: "+l.height+';" />');j.empty();j.append(i);j.append(e)}else{b.find("img").attr({src:o})}g.hideDialog()}})})});b.delegate("a.btn-remove","click",function(){k.val("");b.find("img").remove();if(b.find("div.div-add-img").length==0){b.prepend(c)}else{c.show()}j.empty();j.append(d)});b.delegate("a.btn-view","click",function(){window.open(b.find("img").attr("src"),"_blank")})})},initUploadMultiImage:function(a){$("input[data-multiimage]",a).each(function(){var t=$(this);if(t.attr("data-multiimage-done")){return this}t.attr("data-multiimage-done",true);if(t.attr("multiimage-done")!=undefined){return}if(t.attr("id")==undefined){t.attr("id","multiimage_id_"+new Date().getTime())}var u=t.attr("name");var c={width:"150",height:"150"};if(t.attr("data-image-width")){c.width=t.attr("data-image-width");if(!Util.endWith(c.width,"px")){c.width=c.width+"px"}}if(t.attr("data-image-height")){c.height=t.attr("data-image-height");if(!Util.endWith(c.height,"px")){c.height=c.height+"px"}}var e=t.attr("data-index-prop");var j=t.closest("div.controls");var v=$('<div class="thumbnail thumbnail-'+t.attr("data-multiimage")+'" style="float:left; margin-right: 5px; width: '+c.width+'px"/>').appendTo(j);v.append(t);if(e){var n=t.attr("data-pk");if(n){var m=$('<input type="hidden" name="'+u.substring(0,u.indexOf("]"))+'].id" />');m.val(n);v.append(m);var h=$('<input type="hidden" name="'+u.substring(0,u.indexOf("]"))+'].extraAttributes.operation" />');h.val("update");v.append(h);var q=$('<input type="hidden" name="'+u.substring(0,u.indexOf("]"))+"]."+e+'" />');var g=Number(t.attr("data-index-val"));q.val(g);var d=j.attr("min-index");if(d==undefined){d=1000}d=Number(d);if(g<d){j.attr("min-index",g)}var k=j.attr("pk-count");if(k==undefined){k=0}j.attr("pk-count",Number(k)+1);v.append(q)}else{var q=$('<input type="hidden"  name="'+u.substring(0,u.indexOf("]"))+"]."+e+'" />');var d=j.attr("min-index");if(d==undefined){d=1000}d=Number(d)-100;j.attr("min-index",d);q.val(d);v.append(q);if(t.attr("data-multiimage")=="btn"){t.attr("disabled",true);q.attr("disabled",true)}}}var i=function(){var w=j.attr("pk-count");if(w==undefined){w=0}j.find("> .thumbnail-edit").each(function(){var x=$(this);if(x.find("input[name$='.id']").size()==0){x.find("input").each(function(){var z=$(this);var y=z.attr("name");if(y){z.attr("name",y.substring(0,y.indexOf("[")+1)+w+y.substring(y.indexOf("]"),y.length))}});w++}})};var f=$('<div class="div-add-img" style="line-height: '+c.height+'px; background-color: #EEEEEE; text-align: center;"/>');f.append('<p style="margin:0px"><button class="btn btn-large" type="button">点击上传图片</button></p>');var o=$('<div class="caption" style="height: 15px;padding-top:0px;cursor: crosshair">');var l=$('<a class="btn-add pull-right" style="cursor: pointer;" title="点击上传图片"><i class="fa fa-plus"></i></a>');var b=$('<a class="btn-view" style="cursor: pointer;"  title="查看原始图片"><i class="fa fa-picture-o"></i></a>');var p=$('<a class="btn-remove pull-right"  style="cursor: pointer;" title="点击移除图片"><i class="fa fa-minus"></i></a>');var r=t.val();if(r==undefined||r==""){f.appendTo(v);o.appendTo(v);o.append(l);t.attr("disabled",true)}else{if(READ_FILE_URL_PREFIX){v.append('<img src="'+READ_FILE_URL_PREFIX+r+'" style="cursor: pointer; width: '+c.width+"px; height: "+c.height+'px;" />')}else{v.append('<img src="'+r+'" style="cursor: pointer; width: '+c.width+"px; height: "+c.height+'px;" />')}o.appendTo(v);o.append(b);o.append(p)}j.css("min-height",(Number(c.height)+50)+"px");j.append(j.find(".thumbnail-btn"));var s=KindEditor.editor({allowFileManager:false});j.sortable({items:".thumbnail",stop:function(y,z){var x=$(z.item);if(e){var w=1000;x.parent().find("input[name$='"+e+"']").each(function(A,B){$(this).val(w);w-=100})}else{var w=0;x.parent().find("input[data-multiimage='edit']").each(function(A,C){var D=$(this);var B=D.attr("name");D.attr("name",B.substring(0,B.indexOf("[")+1)+w+B.substring(B.indexOf("]"),B.length));w++})}x.attr("sorted",true)}});v.delegate("div.div-add-img, a.btn-add","click",function(){s.loadPlugin("multiimage",function(){s.plugin.multiImageDialog({showRemote:false,clickFn:function(w){KindEditor.each(w,function(x,z){var y=$('<input type="hidden" data-multiimage="edit" name="'+u+'"/>');if(e){y.attr("data-index-prop",e)}y.val(z.path);v.before(y);AdminPage.initUploadMultiImage(a)});i();s.hideDialog()}})})});v.delegate("img","click",function(){if(v.attr("sorted")){v.removeAttr("sorted");return}s.loadPlugin("image",function(){s.plugin.imageDialog({showRemote:false,clickFn:function(y,B,z,w,x,C){var A=y;if(READ_FILE_URL_PREFIX){A=y.split(READ_FILE_URL_PREFIX)[1]}t.val(A);if(v.find("img").length==0){f.hide();v.prepend('<img src="'+y+'" style="cursor: pointer; width: '+c.width+"; height: "+c.height+';" />');o.empty();o.append(b);o.append(p)}else{v.find("img").attr({src:y})}s.hideDialog()}})})});v.delegate("a.btn-remove","click",function(){var w=$(this).closest(".thumbnail");if(w.find("input[name$='.id']").size()>0){w.find("input[name$='.extraAttributes.operation']").val("remove");w.hide()}else{w.remove();i()}});v.delegate("a.btn-view","click",function(){window.open(v.find("img").attr("src"),"_blank")});t.attr("multiimage-done",true)})},initAjaxBeforeShow:function(a){if(a==undefined){a=$("body")}AdminPage.initDataProfileParam(a);AdminPage.initTreeSelect(a);AdminPage.initUploadBigFile(a);AdminPage.initUploadSingleImage(a);AdminPage.initUploadMultiImage(a);$(".nav[data-active-index]",a).each(function(){var c=$(this);var b=c.attr("data-active-index");if(b==undefined||b==""){return}var d=c.find("li:not(.tools)").index(c.find("li.active"));if(b!=d){c.find("li:not(.tools):eq("+b+") > a").click()}});$("a.x-editable",a).each(function(){var b=$(this);var c=b.attr("data-url");if(c==undefined){c=b.closest("form").attr("action")}var e=b.attr("data-pk");if(e==undefined){e=b.closest("form").find("input[name='id']").val()}var f=b.attr("data-original-title");if(f==undefined){f="数据修改"}var d=b.attr("data-placement");if(d==undefined){d="top"}Util.assertNotBlank(c);Util.assertNotBlank(e);b.editable({url:c,pk:e,title:f,placement:d,params:function(g){g.id=e;g[g.name]=g.value;return g},validate:function(g){var h=b.attr("data-required");if(h=="true"){if($.trim(g)==""){return"数据不能为空"}}},success:function(){if(b.hasClass("editable-bpm-task-transfer")){$("#layout-nav .btn-close-active").click();$(".ajaxify-tasks").ajaxGetUrl($(".ajaxify-tasks").attr("data-url"))}}})});$("div.scroller",a).each(function(){var b;if($(this).attr("data-height")){b=$(this).attr("data-height")}else{b=$(this).css("height")}$(this).slimScroll({size:"7px",color:($(this).attr("data-handle-color")?$(this).attr("data-handle-color"):"#a1b2bd"),railColor:($(this).attr("data-rail-color")?$(this).attr("data-rail-color"):"#333"),position:"right",height:b,alwaysVisible:($(this).attr("data-always-visible")=="true"?true:false),railVisible:($(this).attr("data-rail-visible")=="true"?true:false),wheelStep:5,disableFadeOut:true})});if($.fn.dropdownHover){$('[data-hover="dropdown"]',a).dropdownHover()}},initAjaxAfterShow:function(a){if(a==undefined){a=$("body")}$('.form-body .row[data-equal-height!="false"]',a).each(function(){var b=0;var c=$(this).find(" > div > .form-group > div, > .form-group > div");c.each(function(){var d=$(this).innerHeight();if(d>b){b=d}});c.css("min-height",b)});$("div[data-chart]",a).each(function(){var c=$(this);var f=c.attr("id");if(f==undefined){f="__chart_"+new Date().getTime();c.attr("id",f)}var e=c.attr("data-chart");if(e=="plot"){$.plot(c,c.data("plotData"),c.data("plotOptions"))}else{if(e=="echarts"){var b=echarts.init(document.getElementById(f));var d=c.data("echartsOptions");if(d){d.title=$.extend(true,{x:"center",y:"bottom"},d.title||{});$.each(d.series,function(g,h){if(h.type=="bar"){d.series[g]=$.extend(true,{itemStyle:{normal:{color:function(j){var i=["#97B552","#D87A80","#5AB1EF","#B6A2DE","#E5CF0D"];return i[j.dataIndex]}}}},h)}});b.setOption(d)}else{alert("Undefined Echarts Options")}}}});$(".full-calendar",a).each(function(){$(this).fullCalendar($(this).data("fullCalendarOptions"))});$(".gmaps-baidu",a).each(function(){var c=$(this);var f=c.attr("id");if(f==undefined){f="__map_baidu_id_"+new Date().getTime();c.attr("id",f)}var d=new BMap.Map(f);d.centerAndZoom("北京市",12);d.enableScrollWheelZoom();d.enableContinuousZoom();d.addControl(new BMap.NavigationControl());var e=new BMap.Geocoder();c.bind("mapLocate",function(h,g){e.getPoint(g,function(i){if(i){d.clearOverlays();d.panTo(i);var j=new BMap.Marker(i);d.addOverlay(j);j.setAnimation(BMAP_ANIMATION_BOUNCE);return i}},"北京市")});var b=c.attr("data-init-location");if(b&&b!=""){setTimeout(function(){c.trigger("mapLocate",b)},2000)}d.addEventListener("click",function(h){var g=h.point;e.getLocation(g,function(i){var j=i.addressComponents;i.fullAddress=j.province+j.city+j.district+j.street+j.streetNumber;c.trigger("mapClick",i)})})})},doSomeStuff:function(){myFunc()}}}();