var Page=function(){return{initDynamicTable:function(a){$("table[data-dynamic-table]",a).each(function(){var c=$(this);var b=c.data("dynamicTableOptions");$(this).dynamictable(b)})},initDropdownSelect:function(a){$('input[data-toggle="dropdown-select"]',a).each(function(){var c=$(this);if(c.attr("dropdown-select-done")){return this}c.attr("dropdown-select-done",true);var b=$('<i class="fa fa-angle-double-down btn-toggle"></i>').insertBefore(c);var f=$('<i class="fa fa-times"></i>').insertBefore(c);var g=c.parent().children();g.wrapAll('<div class="input-group" style="width:100%"><div class="input-icon right"></div></div>');f.click(function(){g.val("")});c.attr("autocomplete","off");var e=c.closest(".panel-content");var d=$('<div class="container-dropdownselect" style="display : none;background-color: white;border: 1px solid #CCCCCC;"></div>');if(e.size()>0){d.appendTo(e)}else{d.appendTo($("body"))}if(c.attr("data-min-width")){d.css("min-width",c.attr("data-min-width"))}c.add(c.parent().find("i.btn-toggle")).click(function(){var l=0;var h=0;if(e.size()>0){l=e.offset().left;h=e.offset().top}var k=c.offset();d.css({width:c.outerWidth(),position:"absolute",left:(k.left-l)+"px",top:(k.top-h)+c.outerHeight()+"px"});d.on("");d.data("element",c);d.on("close",function(){d.hide()});d.slideToggle("fast");var j=c.parent().find("i.btn-toggle");if(j.hasClass("fa-angle-double-down")){j.removeClass("fa-angle-double-down");j.addClass("fa-angle-double-up")}else{j.addClass("fa-angle-double-down");j.removeClass("fa-angle-double-up")}if(d.is(":empty")){var i=c.attr("data-url");if(c.attr("data-selected")){if(i.indexOf("?")>-1){i=i+"&selected="+c.attr("data-selected")}else{i=i+"?selected="+c.attr("data-selected")}}d.ajaxGetUrl(i)}});$(document).on("mousedown",function(i){var h=c.parent("div");if(!(h.is(i.target)||h.find(i.target).length||d.is(i.target)||d.find(i.target).length)){d.hide()}})})},initMultiSelectDouble:function(a){if($.fn.multiSelect){$('select[data-toggle="double-multi-select"]',a).each(function(){var b=$(this);if(b.attr("double-multi-select-done")){return this}b.attr("double-multi-select-done",true);b.multiSelect({selectableHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='快速过滤...'>",selectionHeader:"<input type='text' class='form-control search-input' autocomplete='off' placeholder='快速过滤...'>",afterInit:function(f){var g=this;var i=g.$selectableUl.prev();var h=g.$selectionUl.prev();var d="#"+g.$container.attr("id")+" .ms-elem-selectable:not(.ms-selected)";var e="#"+g.$container.attr("id")+" .ms-elem-selection.ms-selected";g.qs1=i.quicksearch(d).on("keydown",function(j){if(j.which===40){g.$selectableUl.focus();return false}});g.qs2=h.quicksearch(e).on("keydown",function(j){if(j.which==40){g.$selectionUl.focus();return false}});var c=b.attr("data-height");if(c){g.$container.find(".ms-list").css({height:c})}},afterSelect:function(){this.qs1.cache();this.qs2.cache()},afterDeselect:function(){this.qs1.cache();this.qs2.cache()}})})}},initSelect2:function(a){if(jQuery().select2){$("select",a).each(function(){var c=$(this);if(c.attr("select2-done")){return this}if(c.is('[data-toggle="tree-select"]')){return this}if(c.is('[data-toggle="double-multi-select"]')){return this}if(c.is(".select2-ignore")){return this}c.attr("select2-done",true);if(c.closest(".ui-search-input,.ui-pager-control").size()>0){return}var h=c.data("placeholder")||(c.data("tags")?"请选择或输入...":"请选择...");if(c.find(' > option[value=""]').size()==0){c.prepend('<option value="">'+h+"</option>")}if(c.find(" > option[selected]").size()==0){c.find(' > option[value=""]').attr("selected",true)}var e={language:"zh-CN",matcher:function(o,k){if($.trim(o.term)===""){return k}if(typeof k.text==="undefined"){return null}if($.trim(k.text)===""){return k}var j=o.term;var n=k.text;var i=Pinyin.getCamelChars(n)+"";var m=i.toUpperCase().indexOf(j.toUpperCase())==0;var l=n.toUpperCase().indexOf(j.toUpperCase())==0;if(m||l){return k}return null}};var d=c.data("url");if(d){e=$.extend({minimumInputLength:1,ajax:{url:d,dataType:"json",data:function(j){var i={rows:c.data("term-rows")||10,page:j.page||1};i[c.data("term-query")]=j.term;return i},processResults:function(i,j){return{results:i.content,pagination:{more:!i.last}}}},templateResult:function(j){if(j.loading){return j.text}var k=j.display;var i=c.attr("data-item-display");if(i){k=j[i]}return k},templateSelection:function(j){if(j.display==undefined){return j.text}var k=j.display;var i=c.attr("data-item-label");if(i){k=j[i]}return k}},e)}var g=c.attr("data-cascade-parent");if(g){var b=c.closest("form").find("select[name='"+g+"']");c.data("cachedOptions",c.children("option").clone());var f=b.val();if(f&&f!=""){c.children("option").each(function(j,k){var m=$(this);var l=m.attr("data-cascade-parent");if(l&&l!=f){m.remove()}})}else{c.empty()}}c.select2(e);c.on("change",function(o){var l=$(this).children("option:selected").val();var s=c.attr("data-cascade-name");if(s){var p=c.closest("form").find("select[name='"+s+"']");p.empty();if(l&&l!=""){var q=p.attr("data-cascade-parent");if(q){p.data("cachedOptions").each(function(){var u=$(this);var t=u.attr("data-cascade-parent");if(t==undefined||t==l){p.append(u);p.select2(e)}})}else{var n=p.data(l);if(n){p.append(n);p.select2(e)}else{var j=c.attr("data-cascade-url");var k=l;var m=c.attr("name");var r=c.attr("data-cascade-property");if(r){var i=c.find("option[value='"+l+"']");m=r;k=i.attr("data-"+r)}j=Util.AddOrReplaceUrlParameter(j,m,k);p.ajaxJsonUrl(j,function(u){var t=[];t.push("<option value=''></option>");for(var v in u){t.push("<option value='"+v+"'>"+u[v]+"</option>")}n=t.join("");p.append(n);p.select2(e);p.data(l,n)})}}}}});if(c.attr("required")=="required"||c.attr("required")=="true"||c.attr("data-rule-required")=="true"){c.on("select2-close",function(i){c.valid()})}})}},initControlLabelTooltips:function(a){$(".control-label[data-tooltips]",a).each(function(){var c=$(this);if(c.attr("data-tooltips-done")){return this}c.attr("data-tooltips-done",true);var d=$('<span class="glyphicon glyphicon-exclamation-sign tooltipster" title="'+c.attr("data-tooltips")+'"></span>').appendTo(c);var b="top";if(c.find("[data-rule-date]").length>0){b="right"}if(c.attr("data-tooltipster-position")){b=c.attr("data-tooltipster-position")}d.tooltipster({contentAsHTML:true,offsetY:15,theme:"tooltipster-punk",position:b})})},initTextareaMaxlength:function(a){$("textarea[maxlength]",a).each(function(){var b=$(this);if(b.attr("data-maxlength-done")){return this}b.attr("data-maxlength-done",true);b.maxlength({limitReachedClass:"label label-danger",alwaysShow:true})})},initTextareaHtmleditor:function(a){$("textarea[data-htmleditor='kindeditor']",a).each(function(){var c=$(this);if(c.attr("data-htmleditor-done")){return this}c.attr("data-htmleditor-done",true);var b=c.attr("data-height");if(b==undefined){b="500px"}KindEditor.create(c,{allowFileManager:false,width:"100%",height:b,minWidth:"200px",minHeight:"60px",afterBlur:function(){this.sync()}})})},initUploadImage:function(a){$('input[data-upload="image"]',a).each(function(){var f=$(this);if(f.attr("data-upload-done")){return this}f.attr("data-upload-done",true);if(f.attr("id")==undefined){f.attr("id","image_id_"+new Date().getTime())}var e={"vertical-align":"top","max-width":"200px","max-height":"200px"};if(f.attr("data-max-width")){e["max-width"]=f.attr("data-max-width");if(!Util.endWith(e["max-width"],"px")&&!Util.endWith(e["max-width"],"%")){e["max-width"]=e["max-width"]+"px"}}if(f.attr("data-max-height")){e["max-height"]=f.attr("data-max-height");if(!Util.endWith(e["max-height"],"px")&&!Util.endWith(e["max-height"],"%")){e["max-height"]=e["max-height"]+"px"}}if(Global.isIELowerVersion()){var c=$('<a  href="javascript:;"></a>').insertAfter(f);var h=f.val();if(h!=""){if(READ_FILE_URL_PREFIX){h=READ_FILE_URL_PREFIX+h}$img=$('<img class="image-display" data-to="'+f.attr("name")+'"  src="'+h+'">').appendTo(c);$img.css(e);$img.css({"margin-left":"90px"})}c.children("img").css(e);var b=$('<input  type="file" name="fileUpload"  />');b.attr("style","position:absolute;left:0;top:0;width:85px;height:34px;z-index:999;");b.appendTo(c);var d=f.attr("data-url");if(d==undefined){d=WEB_ROOT+"/w/file/upload/single"}var g=f.attr("data-zoomout-to");if(g>0){d+="?data-zoomout-to="+g}b.on("change",function(){b.wrap('<form  enctype="multipart/form-data" method="post"></form>');var i=b.parent("form");i.attr("action",d);var j=f.parent();App.blockUI({target:j,animate:true,overlayColor:"none"});i.ajaxSubmit({dataType:"html",method:"post",success:function(l){b.unwrap();l=jQuery.parseJSON(l);if(l.type=="success"){var o=l.data;f.val(o);var k=f.closest("form");k.data("validator").element(f);var m=f.closest(".form-group").find("img.image-display");if(m.size()==0){m=$('<img class="image-display" >').appendTo(c);m.css(e);m.css({"margin-left":"90px"})}if(READ_FILE_URL_PREFIX){o=READ_FILE_URL_PREFIX+o}m.attr("src",o);var n=f.attr("data-grid-reload");if(n){$(n).jqGrid("setGridParam",{datatype:"json"}).trigger("reloadGrid")}App.unblockUI(j)}else{Global.notify("error",l.message);App.unblockUI(j)}},error:function(m,l,k){Global.notify("error","文件上传处理异常，请联系管理员");App.unblockUI(j)}});return false})}else{var h=f.val();if(h==""){h=WEB_ROOT+"/assets/w/app/images/upload.jpg"}else{if(READ_FILE_URL_PREFIX){h=READ_FILE_URL_PREFIX+h}}var c=$('<a  href="javascript:;"><img class="image-display" data-to="'+f.attr("name")+'" src="'+h+'"></a>').insertAfter(f);c.children("img").css(e);c.click(function(){Global.triggerSingleFileUpload(f)})}})},initImagePreivew:function(a){$("img[data-toggle='preview']",a).each(function(){var b=$(this);b.mouseenter(function(g){this.t=this.title;this.title="";var h=(this.t!="")?"<br/>"+this.t:"";var f=$("#image-preview");if(f.size()==0){var d=$(window).width()-200;f=$("<p id='image-preview'><img src='"+this.src+"' alt='Image preview'/>"+h+"</p>").appendTo($("body"));f.css("top","10px").css("left","10px")}else{f.children("img").attr("src",this.src)}f.fadeIn("fast")})})},initAjaxBeforeShow:function(a){if(a==undefined){a=$("body")}if($.fn.bootstrapSwitch){$(".make-switch:not(.has-switch)")["bootstrapSwitch"]()}Page.initTextareaHtmleditor(a);Page.initUploadImage(a);Page.initImagePreivew(a);$("input.knob",a).each(function(){$(this).knob({dynamicDraw:true,thickness:0.2,tickColorizeValues:true,skin:"tron",readOnly:true})})},initAjaxAfterShow:function(a){if(a==undefined){a=$("body")}Page.initDropdownSelect(a)},doSomeStuff:function(){myFunc()}}}();