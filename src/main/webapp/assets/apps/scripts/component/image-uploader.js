+function(d){var e={Single:"single",MultiTextSplit:"multi-text-split",MultiArrayElements:"multi-arr"};var c=function(g,f){this.$element=d(g);this.options=d.extend({},c.DEFAULTS,f);this.init()};c.VERSION="1.0.0";c.DEFAULTS={height:"120px",width:"120px",maximumSelectionLength:0,imageHeight:"100%",imageWidth:"100%"};c.prototype.loadKindEditor=function(i,g){var f=this.options;var h=this.kindEditor;if(!h){h=KindEditor.editor({allowFileManager:false,formatUploadUrl:false});this.kindEditor=h}if(g||f.imageuploader==e.Single||f.maximumSelectionLength==1){h.loadPlugin("image",function(){h.plugin.imageDialog({showRemote:false,clickFn:i})})}else{h.loadPlugin("multiimage",function(){h.plugin.multiImageDialog({showRemote:false,clickFn:i})})}};c.prototype.init=function(){var o=d(this.$element);var q=this.options;var k=this;var l=function(r){r.on("load",function(){var t=r.width();var s=r.height();if(t>s){r.css({width:"100%",height:"auto"})}else{r.css({width:"auto",height:"100%"})}})};var f=function(t,s){var u=[];var v=Util.smartParseURL(s);u.push('<div class="mt-overlay-1 mt-element-multiimage-item" data-url="'+s+'" style="width:'+t.width+";height:"+t.height+'; ">');u.push('  <img src="'+v+'"/>');u.push('  <div class="mt-overlay">');u.push('    <ul class="mt-info">');u.push("      <li>");u.push('        <a class="btn default btn-outline btn-remove" href="javascript:;">');u.push('          <i class="fa fa-remove"></i>');u.push("        </a>");u.push("      </li>");u.push("      <li>");u.push('        <a class="btn default btn-outline btn-preview" target="_blank" href="'+s+'">');u.push('          <i class="fa fa-search-plus"></i>');u.push("        </a>");u.push("      </li>");u.push("      <li>");u.push('        <a class="btn default btn-outline btn-edit" href="javascript:;">');u.push('          <i class="fa fa-edit"></i>');u.push("        </a>");u.push("      </li>");u.push("    </ul>");u.push("  </div>");u.push("</div>");var r=d(u.join(""));l(r.children("img"));return r};var p=d('<div class="mt-element-overlay mt-element-multiimage" style="height:auto;min-height:'+q.height+'"></div>');o.after(p);if(q.imageuploader==e.MultiTextSplit){var h=o.val();if(h){var m=h.split(",");d.each(m,function(r,s){p.append(f(q,s))})}}var i=[];i.push('<div class="mt-overlay-1 mt-element-multiimage-item mt-element-multiimage-add" style="width:'+q.width+";height:"+q.height+'; ">');i.push('  <i class="fa fa-plus" style="line-height: '+q.height+';"></i>');i.push('  <div class="mt-overlay">');i.push('    <ul class="mt-info">');i.push("      <li>");i.push('        <a class="btn default btn-outline btn-add" href="javascript:;">');i.push('          <i class="fa fa-plus"></i>');i.push("        </a>");i.push("      </li>");i.push("    </ul>");i.push("  </div>");i.push("</div>");var j=d(i.join(""));p.append(j);var n=function(){var r=[];var s=p.children(".mt-element-multiimage-item:not(.mt-element-multiimage-add)");s.each(function(){r.push(d(this).attr("data-url"))});o.val(r.join(","))};var g=function(){if((q.imageuploader==e.Single||q.maximumSelectionLength==1)&&p.children(".mt-element-multiimage-item:not(.mt-element-multiimage-add)").size()>0){j.hide()}else{j.show()}n()};g();p.on("click",".btn-add",function(){k.loadKindEditor(function(r){k.kindEditor.hideDialog();if(typeof r=="string"){j.before(f(q,r))}else{d.each(r,function(s,t){j.before(f(q,t.url))})}g()})});p.on("click",".btn-remove",function(s){var r=d(s.target).closest(".mt-element-multiimage-item");r.remove();g()});p.on("click",".btn-edit",function(s){var r=d(s.target).closest(".mt-element-multiimage-item");k.loadKindEditor(function(t){k.kindEditor.hideDialog();r.attr("data-url",t);var v=Util.smartParseURL(t);var u=r.children("img");u.attr("src",v);l(u);n()},true)})};function b(f){return this.each(function(){var i=d(this);var h=i.data("ExtImageUploader");var g=typeof f=="object"&&f;if(!h){i.data("ExtImageUploader",(h=new c(this,g)))}if(typeof f=="string"){h[f]()}})}var a=d.fn.extImageUploader;d.fn.extImageUploader=b;d.fn.extImageUploader.Constructor=c;d.fn.extImageUploader.noConflict=function(){d.fn.extImageUploader=a;return this};Global.addComponent({plugin:b,runPoint:Global.Component_Run_Point.BeforeAjaxPageShow,expr:"input[data-imageuploader]"})}(jQuery);