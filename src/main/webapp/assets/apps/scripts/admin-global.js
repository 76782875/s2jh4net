var AdminGlobal=function(){var c;var b=new Object();var a="SESSION_STORAGE_LAST_HASH";return{updateMessageCount:function(){var d=$("#header_notification_bar");if(d.size()>0){$.ajax({dataType:"json",method:"get",url:WEB_ROOT+"/notify-message/count",success:function(f){var g=f.data;if(g>0){var h="<a href='#/admin/profile/notify-message?readed=no'>您有 "+g+" 条未读公告信息</a>";$(".message-info",d).html(h);$(".badge",d).html(g).show()}else{var h="<a href='#/admin/profile/notify-message' data-path='公告信息列表'>暂无未读，点击查看公告信息列表</a>";$(".message-info",d).html(h);$(".badge",d).html(0).hide()}$(".number-notify-message-count").html(g)}})}var e=$("#header_inbox_bar");if(e.size()>0){$.ajax({dataType:"json",method:"get",url:WEB_ROOT+"/user-message/count",success:function(f){var g=f.data;if(g>0){var h="<a href='#/admin/profile/user-message?readed=no'>您有 "+g+" 条未读个人消息</a>";$(".message-info",e).html(h);$(".badge",e).html(g).show()}else{var h="<a href='#/admin/profile/user-message'>暂无未读，点击查看个人消息列表</a>";$(".message-info",e).html(h);$(".badge",e).html(0).hide()}$(".number-user-message-count").html(g)}})}},init:function(){b[DASHBOARD_URI]="Dashboard";if(sessionStorage.getItem(a)){var i=JSON.parse(sessionStorage.getItem(a));b[i.uri]=i.path}if(Util.isDebugEnable()){Util.debug("Init HASH_MAPPING_DATA: "+JSON.stringify(b))}var g=$("div.page-content");if(g.size()>0){var h=$(window).height()-g.offset().top-$("div.footer").outerHeight()-8;g.css({"min-height":h})}if($.fn.editable){$.fn.editable.defaults.inputclass="form-control"}$(".theme-panel .theme-options").find("select").each(function(){$(this).val($(this).attr("data-selected")).change()});var e=$(window).height()-$("body > .header").height()-$("body > .footer").height()-15;$(".page-container > .page-content").css({"min-height":e+"px"});$(window).resize(function(){if($.fn.jqGrid){Grid.refreshWidth()}$("div[data-chart='echarts']").each(function(){var l=$(this).data("echart");if(l!=undefined){l.resize()}})});$("#a-logout").click(function(){bootbox.confirm("确认注销登录吗？",function(l){if(l){window.location.href=WEB_ROOT+"/admin/logout"}})});$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(p){var l=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var o=l.find("> .nav > li.active > a");var n=l.find(o.attr("href"));var m=o.attr("data-url");n.ajaxGetUrl(m)});var d=$(".page-sidebar-menu");if(d.size()>0){var k=function(p,r){var o=p.initOpen?(p.url?"":"open"):"";var q=p.active?"active":"";var m=p.url?WEB_ROOT+"/admin":"javascript:;";var s=r[r.length-1];var n=false;if(p.url){n=(Pinyin.getCamelChars(s)+"").toLowerCase()}var l='<li class="nav-item '+q+" "+o+'" data-path="'+p.path+'">';l+='<a  data-path="'+p.path+'"';l+=(n?' data-py="'+n+'"':"");l+=' href="'+(p.url?"#"+p.url:"javascript:;")+'"';l+=' class="nav-link '+(p.url?"":" nav-toggle")+'"';l+=">";if(p.style){l+='<i class="fa '+p.style+'"></i>'}else{if(r.length==1){l+='<i class="fa fa-cogs"></i>'}else{if(p.url){l+='<i class="fa fa-dot-circle-o"></i>'}else{l+='<i class="fa fa-ellipsis-vertical"></i>'}}}if(r.length==1){l+='<span class="title">'+s+"</span>";l+='<span class="selected"></span>'}else{l+=s}if(!p.url){l+='<span class="arrow  '+o+'"></span></a></li>'}l+="</a></li>";return l};d.ajaxJsonUrl(WEB_ROOT+"/admin/menus",function(m){$.each(m,function(q,r){var s=r.path.split(":");if(s.length==1){d.append(k(r,s))}else{var p=[];$.each(s,function(v,u){if(v<s.length-1){p.push(u)}});var o=p.join(":");var t=d.find("li[data-path='"+o+"']");var n=t.find("> ul.sub-menu");if(n.size()==0){n=$('<ul class="sub-menu" style="display: '+(t.is(".open")?"block":"none")+';">').appendTo(t)}n.append(k(r,s))}});if(sessionStorage.getItem(a)){var l=JSON.parse(sessionStorage.getItem(a));$.address.value(l.uri)}else{$.address.value("/dashboard")}});$("body").on("click",'a[href^="#/"]',function(o){var l=$(this);var n=l.attr("href").replace("#","");var m=l.data("path");if(m===undefined){m=l.text()}b[n]=m;if(Util.isDebugEnable()){Util.debug("HASH_MAPPING_DATA: "+JSON.stringify(b))}$.address.value(n)});$.address.change(function(m){var p=m.value;if(p==""||p=="/"||!Util.startWith(p,"/")){return false}if(p=="/lock"){$.backstretch(["assets/img/bg/1.jpg","assets/img/bg/2.jpg","assets/img/bg/3.jpg","assets/img/bg/4.jpg"],{fade:1000,duration:8000});$(".page-container,.header,.footer").hide();$("#form-unlock").find(":text").focus().val("");$("#page-lock").show();$("#form-unlock").find("input").first().focus();$("body").ajaxPostURL({url:WEB_ROOT+"/layout!lock",confirmMsg:false})}if(p=="/dashboard"){p=DASHBOARD_URI}AdminGlobal.addOrActivePanel(p);var o=$('.page-sidebar-menu li.nav-item > a[href^="#'+p+'"]');if(o.size()>0){var l=$(".page-sidebar-menu").find("li");var n=b[p];AdminGlobal.addOrActivePanel(p);l.each(function(){var q=$(this);q.removeClass("active");if(Util.startWith(n,q.data("path"))){q.addClass("active")}});return true}});$('.sidebar-search input[name="search"]').autocomplete({autoFocus:true,source:function(n,l){var m=d.find("a[data-py]");return l(m.map(function(){var r=n.term.toLowerCase();var o=$(this);var q=o.text();var p=o.attr("data-py");if(p.indexOf(r)>-1||q.indexOf(r)>-1){return{label:$.trim(q),link:o,href:o.attr("href")}}}))},minLength:1,select:function(m,n){var l=n.item;$(this).parent().find(".submit").data("link",l.link);l.link.click();return true}}).focus(function(){$(this).select()}).val("").focus();$('.sidebar-search input[name="search"]').parent().find(".submit").click(function(){var l=$(this).data("link");if(l){l.click()}return false})}$("div#portlet-layout > .portlet-title-layout > .tools > .reload").click(function(p){var l=$("div#portlet-layout").find(" > .portlet-body > .portlet-tabs");var o=l.find("> .nav > li.active > a");var n=l.find(o.attr("href"));var m=o.attr("data-url");n.ajaxGetUrl(m)});jQuery("body").on("click","#layout-nav .btn-close-active",function(o){var n=$("#layout-nav");var m=n.next(".tab-content").find(".panel-content:visible").attr("data-url");var l=n.find(" > .btn-group > ul.dropdown-menu");l.find("a[href='"+m+"']").find(".badge").click()});jQuery("body").on("click","ul.nav > li.tools > .reload",function(p){p.preventDefault();var l=$(this).closest(".nav");var o=l.find("li.active > a");var n=l.closest(".tabbable").find(o.attr("href"));if(o.attr("data-url")){var m=o.attr("data-url");n.ajaxGetUrl(m,function(){n.find(".tabbable:first > .nav > li.active > a").click()})}else{if(jQuery().jqGrid){n.find("table.ui-jqgrid-btable").each(function(){var q=$(this);q.trigger("clearToolbar");var r=q.attr("data-url");q.jqGrid("setGridParam",{datatype:"json",url:r}).trigger("reloadGrid")})}}});$(".page-sidebar, .header").on("click",".sidebar-toggler",function(l){Grid.refreshWidth()});if($.fn.fileupload){$("#fileupload").fileupload({autoUpload:false,dataType:"json",url:WEB_ROOT+"/sys/attachment-file!uploadMulti"});var j=$("#fileupload");var f=null;jQuery("body").on("click","a.btn-fileinput-trigger",function(m){f=$(this);var l=f.attr("data-category");if(l){j.find("input[name='attachmentName']").val("_attachment_"+l)}j.find("tbody.files").empty()});jQuery("#fileupload-dialog").on("click",".modal-footer .btn-add",function(n){var m=f.parent().find("table.table-filelist");if(m.size()==0){m=$('<table role="presentation" class="table table-striped table-filelist clearfix"><tbody class="files"></tbody></table>').insertAfter(f)}var l=m.find("tbody.files");$("#fileupload").find("tbody.files tr.template-download").each(function(){l.append($(this).clone(true))});$("#fileupload-dialog").find('.modal-footer [data-dismiss="modal"]').click()})}jQuery("body").on("click",'a[data-toggle="panel"],button[data-toggle="panel"]',function(m){m.preventDefault();var l=$(this);AdminGlobal.addOrActivePanel(l)});jQuery("body").on("click",'a[data-upload="btn-single-file"],button[data-upload="btn-single-file"]',function(m){m.preventDefault();var l=$(this);Global.triggerSingleFileUpload(l)});jQuery("body").on("click","tbody.select-table-checkbox",function(m){var l=$(this).find(".table-checkbox :checkbox");if(!(l.is(m.target)||l.find(m.target).length)){l.attr("checked",!l.is(":checked"))}});AdminGlobal.updateMessageCount();setTimeout(function(){AdminGlobal.updateMessageCount()},10*60*1000)},findUserProfileParams:function(d){if(c==undefined||c==null){c=$("body").cacheData(WEB_ROOT+"/admin/sys/user-profile-data/params.json")}return c[d]},setUserProfileParams:function(d,e){if(c==undefined||c==null){c=$("body").cacheData(WEB_ROOT+"/admin/sys/user-profile-data/params.json")}c[d]=e},addOrActivePanel:function(f){var n=b[f];if(n==undefined){n=""}sessionStorage.setItem(a,JSON.stringify({uri:f,path:n}));var d=Util.smartParseURL(f);var k=n.split(":");var g=k[k.length-1];var n='<li><a href="#/dashboard" class="btn-dashboard" data-path="Dashboard"><i class="fa fa-home"></i> 首页 </a></li> ';var i=$("#layout-nav");$.each(k,function(p,o){o=o;if(p<k.length-1){n+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> '+o+" </li>"}else{n+='<li class="hidden-inline-xs"><i class="fa fa-angle-right"></i> <a class="reload" href="javascript:;">'+o+"</a> </li>"}});i.children(".page-breadcrumb").html(n);var h=i.next(".tab-content");var m=h.find("> div[data-url='"+d+"']");if(m.length==0){m=$('<div data-url="'+d+'" class="panel-content"></div>').appendTo(h);m.ajaxGetUrl(d)}else{m.show()}h.find("> div").not(m).hide();var e=i.find(" > .page-toolbar > .btn-group > ul.dropdown-menu");var j=e.find("> li > a[rel='address:"+f+"']");if(j.length==0){j=$('<a href="javascripts:;" rel="address:'+f+'">'+g+'<span class="badge badge-default">X</span></a>').appendTo(e).wrap("<li/>");j.find(".badge").click(function(q){q.preventDefault();q.stopPropagation();var p=false;m.find("form[method='post']:not(.form-track-disabled)[form-data-modified='true']").each(function(){var s=$(this);if(!confirm("当前表单有修改数据未保存，确认离开当前表单吗？")){p=true;return false}});if(!p){j.parent("li").remove();m.remove();var o=1;e.find("> li").not(j).each(function(){var s=$(this).attr("count");if(s){if(Number(s)>o){o=Number(s)}}});var r=e.find("> li[count='"+o+"'] > a");if(r.length>0){r.click()}else{$("#layout-nav >  li > .btn-dashboard").click()}}})}var l=1;e.find("> li").each(function(){$(this).removeClass("active");var o=$(this).attr("count");if(o){if(Number(o)>l){l=Number(o)}}});j.parent("li").addClass("active");j.parent("li").attr("count",l+1);i.find("> ul.page-breadcrumb a.reload").click(function(o){o.preventDefault();m.ajaxGetUrl(d)})}}}();