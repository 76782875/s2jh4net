## 演示运行

### 特别说明

* 框架默认提供为Linux Shell脚本，在Mac OS和CentOS中运行验证过，如果是Windows系统可参考脚本逻辑编写相应bat运行脚本。当然非常欢迎以Pull Request形式提交对应bat脚本文件。

### 环境准备

* Oracle JDK 1.8+

框架一些组件已经升级使用最新版本，因此需要使用JDK 1.8+版本，同时由于框架使用了JCaptch验证码组件，但是这个组件依赖较早版本JDK的image jpeg相关API，
在新版本的OpenJDK已经移除，因此需要安装Oracle版本的JDK 1.8+版本（包含image jpeg相关API）才能正常启动和运行应用。

请自行访问Oracle官方站点下载安装Oracle JDK 1.8版本（1.9版本未验证，不确定兼容性，建议采用1.8版本）：
http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html

可选择下载安装版本或解压缩版本，如果是解压缩版本，请确保正确设置 JAVA_HOME 环境变量，通过如下命令验证一下：

```bash
#java -version
java version "1.8.0_XXX"
Java(TM) SE Runtime Environment (build 1.8.0_XXX)
Java HotSpot(TM) 64-Bit Server VM (build XXX, mixed mode)
```

```bash
#echo $JAVA_HOME
${JDK_INSTALL}/jdk1.8.0_XXX
```

* Docker运行环境安装

对于Docker相关知识本文不做阐述请自行搜索查阅了解，请参考官方指南安装Docker运行环境：https://www.docker.com/community-edition

Docker最新版本安装完成后，可简单执行如下命令验证：

docker -v

出现类似信息："Docker version 17.06.2-ce, build cec0b72"

### 演示应用一键构建部署运行

cd到 entdiy-devops/entdiy-ops-docker 目录，请检查 all-in-one.sh 脚本是否有可执行属性，如果没有请在终端执行如下命令初始化相关脚本可执行属性：

```bash
chmod +x all-in-one.sh
```

然后运行即可（ -p 后面指定服务端口号，可根据本地实际情况修改，若有变更后续相关端口描述文本请对应修改；如果未指定，默认为8080）：

```bash
./all-in-one.sh -p 8080
```

然后等待如下大致运行过程：

* maven相关依赖下载并构建打包war文件，
* Docker相关image镜像自动下载，启动相关Docker基础服务：redis占用6379端口，mysql占用3306端口，
  如果你本地已经开启这些端口服务，请先暂停本地对应端口服务再运行或者熟悉脚本逻辑后自行修改脚本中相关端口号定义；
* redis、mysql、tomcat、oracle jdk环境服务Docker部署框架应用

最后应该大致出现 "docker started for entdiy-8080." 信息，则说明应用已经部署到Docker环境开始运行。可随时在终端执行docker日志查看命令实时查看应用运行日志：

```bash
docker logs -f --tail 1 entdiy-8080
```

根据机器配置差异，等待若干分钟后，Docker日志控制台出现大致 "org.apache.catalina.startup.Catalina.start Server startup in XXX ms" 信息，
则说明整个构建部署运行完成，打开浏览器访问：

http://127.0.0.1:8080/entdiy/admin

